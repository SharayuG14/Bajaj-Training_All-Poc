<!-- @if (product && product.data.length > 0)
{
<div class="container text-center">
    <h1>{{title}}</h1>
    <div class="row">
        @for (product of product.data;track product._id)
        {
        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow-lg m-3 bg-body-tertiary rounded" style="width: 100%;">
                <img [src]="product.images[0]" class="card-img-top" [alt]="product.name" height="250">
                <div class="card-body">
                    <h5 class="card-title">{{product.name}}</h5>
                    <p class="card-text">{{product.description}}</p>
                    <hr>
                    <div class="text-center">
                        <a class="btn btn-success" (click)="onProductSelection(product._id)">Show Details</a>
                        <a class="btn btn-dark">Add To Cart</a>
                    </div>
                </div>
            </div>
        </div>
        }
    </div>
</div>
@if(selectedProductId){
<bajaj-product-details [productId]="selectedProductId" (onClose)="clearSelectedProduct()"></bajaj-product-details>
}

}@else {
<h4>Sorry! We did not find any products! Please try after some time!</h4>
}
 <div class="text-center">
    <h1>@ViewBag.PageTitle</h1>
    <hr />
    <div class="container-fluid">
        <div class="row">
            @foreach (var product in Model)
            {
                Mobile-first layout: 12 columns on mobile, 6 on tablet, 3 on desktop 
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="card shadow-lg m-3 bg-body-tertiary rounded" style="width: 100%;">
                        <img src="~/@Url.Content(product.Picture)" class="card-img-top" alt="@product.ProductName" height="250">
                        <div class="card-body">
                            <h5 class="card-title">@product.ProductName</h5>
                            <p class="card-text">@product.Description</p>
                            <hr>
                            <div class="text-center">
                                <a class="btn btn-success" asp-area="Products" 
                                                           asp-controller="Home"
                                                           asp-action="Details"
                                                           asp-route-id="@product.ProductId">Show Details</a>
                                <a class="btn btn-dark" asp-area="Carts"
                                                        asp-controller="Home"
                                                        asp-action="AddToCart"
                                                        asp-route-productId="@product.ProductId">Add To Cart</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
 -->


<!-- Check if products exist -->
<div class="container mt-4">
  <!-- Category Header -->
  <div *ngIf="category" class="category-header mb-4">
    <div class="card">
      <img [src]="category.image" class="card-img-top" [alt]="category.name" style="height: 300px; object-fit: cover;">
      <div class="card-body">
        <h1 class="card-title">{{ category.name }}</h1>
        <p class="card-text text-muted">Explore our collection of {{ category.name | lowercase }}</p>
      </div>
    </div>
  </div>

  <h2 class="text-center mb-4">{{ title }}</h2>

  <!-- Loading state -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading products...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error:</strong> {{ errorMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <!-- Products grid -->
  <div class="row" *ngIf="!loading && product.data.length > 0">
    <div class="col-12 col-md-6 col-lg-3 mb-4" *ngFor="let prod of paginatedProducts; trackBy: trackById">
      <div class="card h-100 shadow-sm">
        <!-- Product Image -->
        <img [src]="prod?.images?.[0] || 'assets/images/placeholder.png'" 
             [alt]="prod?.name || 'Product image'"
             class="card-img-top img-fluid" 
             style="height: 200px; object-fit: cover; border-radius: 8px;">

        <div class="card-body d-flex flex-column">
          <!-- Product Name -->
          <h5 class="card-title">{{ prod?.name }}</h5>

          <!-- Product Description -->
          <p class="card-text text-truncate" style="flex-grow:1;">{{ prod?.description }}</p>

          <!-- Price & Discount -->
          <div class="mb-2">
            <span class="fw-bold fs-6">
              ₹{{ ((prod?.price || 0) * (1 - ((prod?.discount || 0)/100))) | number:'1.0-0' }}
            </span>
            <small *ngIf="prod?.discount" class="text-decoration-line-through text-muted ms-2">
              ₹{{ prod?.price | number:'1.0-0' }}
            </small>
            <span *ngIf="prod?.discount" class="badge bg-success ms-2">{{ prod?.discount }}% OFF</span>
          </div>

          <!-- Rating Stars -->
          <div class="mb-2">
            <ng-container *ngFor="let i of [1,2,3,4,5]">
              <i class="fa-star"
                 [ngClass]="{
                   'fas text-warning': i <= ((prod?.rating || 0) | round),
                   'far text-secondary': i > ((prod?.rating || 0) | round)
                 }">
              </i>
            </ng-container>
            <span class="ms-2">({{ prod?.numReviews || 0 }})</span>
          </div>

          <!-- Buttons -->
          <div class="mt-auto d-flex justify-content-between align-items-center">
            <button class="btn btn-primary btn-sm" 
                    (click)="onProductSelection(prod._id)">
              View Details
            </button>
            <button class="btn btn-outline-secondary btn-sm"
                    (click)="addToCart(prod)"
                    [disabled]="addedToCartMap[prod._id]">
              {{ addedToCartMap[prod._id] ? 'Added' : 'Add to Cart' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container text-center mt-4" *ngIf="!loading && product.data.length > 0">
    <button class="btn btn-outline-primary me-2" (click)="prevPage()" [disabled]="currentPage === 1">
      <i class="fa fa-chevron-left"></i> Previous
    </button>
    <span class="fw-bold mx-2">Page {{ currentPage }} / {{ Math.ceil(product.data.length / itemsPerPage) }}</span>
    <button class="btn btn-outline-primary ms-2"
            (click)="nextPage()"
            [disabled]="currentPage >= Math.ceil(product.data.length / itemsPerPage)">
      Next <i class="fa fa-chevron-right"></i>
    </button>
  </div>

  <!-- Product Details Modal -->
  <bajaj-product-details 
    *ngIf="selectedProductId" 
    [productId]="selectedProductId"
    (onClose)="clearSelectedProduct()">
  </bajaj-product-details>

  <!-- No products message -->
  <div *ngIf="!loading && product.data.length === 0" class="text-center mt-4">
    <h5>No products found. Please try again later.</h5>
  </div>
</div>
